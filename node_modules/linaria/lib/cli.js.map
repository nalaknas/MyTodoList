{"version":3,"sources":["../src/cli.ts"],"names":["argv","yargs","usage","option","alias","type","description","requiresArg","demandOption","default","implies","strict","processFiles","_","outDir","sourceMaps","sourceRoot","insertCssRequires","configFile","config","ignore","files","options","count","resolvedFiles","reduce","acc","pattern","glob","sync","absolute","forEach","filename","outputFilename","resolveOutputFilename","cssText","sourceMap","cssSourceMapText","fs","readFileSync","toString","pluginOptions","mkdirp","path","dirname","cssContent","writeFileSync","inputFilename","resolve","relative","normalizedInputFilename","resolveRequireInsertionFilename","relativePath","requireStatement","startsWith","inputContent","trim","endsWith","console","log","replace","folderStructure","process","cwd","outputBasename","basename","extname","join"],"mappings":"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","sourcesContent":["/**\n * This file contains a CLI for Linaria.\n */\n\nimport path from 'path';\nimport fs from 'fs';\nimport normalize from 'normalize-path';\nimport mkdirp from 'mkdirp';\nimport glob from 'glob';\nimport yargs from 'yargs';\nimport transform from './transform';\n\nconst { argv } = yargs\n  .usage('Usage: $0 [options] <files ...>')\n  .option('config', {\n    alias: 'c',\n    type: 'string',\n    description: 'Path to a config file',\n    requiresArg: true,\n  })\n  .option('out-dir', {\n    alias: 'o',\n    type: 'string',\n    description: 'Output directory for the extracted CSS files',\n    demandOption: true,\n    requiresArg: true,\n  })\n  .option('source-maps', {\n    alias: 's',\n    type: 'boolean',\n    description: 'Generate source maps for the CSS files',\n    default: false,\n  })\n  .option('source-root', {\n    alias: 'r',\n    type: 'string',\n    description: 'Directory containing the source JS files',\n    requiresArg: true,\n  })\n  .option('insert-css-requires', {\n    alias: 'i',\n    type: 'string',\n    description:\n      'Directory containing JS files to insert require statements for the CSS files',\n    requiresArg: true,\n  })\n  .implies('insert-css-requires', 'source-root')\n  .option('ignore', {\n    alias: 'x',\n    type: 'string',\n    description: 'Pattern of files to ignore. Be sure to provide a string',\n    requiresArg: true,\n  })\n  .alias('help', 'h')\n  .alias('version', 'v')\n  .strict();\n\nprocessFiles(argv._, {\n  outDir: argv['out-dir'],\n  sourceMaps: argv['source-maps'],\n  sourceRoot: argv['source-root'],\n  insertCssRequires: argv['insert-css-requires'],\n  configFile: argv.config,\n  ignore: argv.ignore,\n});\n\ntype Options = {\n  outDir: string;\n  sourceMaps?: boolean;\n  sourceRoot?: string;\n  insertCssRequires?: string;\n  configFile?: string;\n  ignore?: string;\n};\n\nfunction processFiles(files: string[], options: Options) {\n  let count = 0;\n\n  const resolvedFiles = files.reduce(\n    (acc, pattern) => [\n      ...acc,\n      ...glob.sync(pattern, { absolute: true, ignore: options.ignore }),\n    ],\n    [] as string[]\n  );\n\n  resolvedFiles.forEach((filename) => {\n    const outputFilename = resolveOutputFilename(filename, options.outDir);\n\n    const { cssText, sourceMap, cssSourceMapText } = transform(\n      fs.readFileSync(filename).toString(),\n      {\n        filename,\n        outputFilename,\n        pluginOptions: {\n          configFile: options.configFile,\n        },\n      }\n    );\n\n    if (cssText) {\n      mkdirp.sync(path.dirname(outputFilename));\n\n      const cssContent =\n        options.sourceMaps && sourceMap\n          ? `${cssText}\\n/*# sourceMappingURL=${outputFilename}.map */`\n          : cssText;\n\n      fs.writeFileSync(outputFilename, cssContent);\n\n      if (\n        options.sourceMaps &&\n        sourceMap &&\n        typeof cssSourceMapText !== 'undefined'\n      ) {\n        fs.writeFileSync(`${outputFilename}.map`, cssSourceMapText);\n      }\n\n      if (options.insertCssRequires && options.sourceRoot) {\n        const inputFilename = path.resolve(\n          options.insertCssRequires,\n          path.relative(options.sourceRoot, filename)\n        );\n\n        const normalizedInputFilename = resolveRequireInsertionFilename(\n          inputFilename\n        );\n\n        const relativePath = normalize(\n          path.relative(path.dirname(inputFilename), outputFilename)\n        );\n\n        const requireStatement = `\\nrequire('${\n          relativePath.startsWith('.') ? relativePath : `./${relativePath}`\n        }');`;\n\n        const inputContent = fs.readFileSync(normalizedInputFilename, 'utf-8');\n\n        if (!inputContent.trim().endsWith(requireStatement)) {\n          fs.writeFileSync(\n            normalizedInputFilename,\n            `${inputContent}\\n${requireStatement}\\n`\n          );\n        }\n      }\n\n      count++;\n    }\n  });\n\n  // eslint-disable-next-line no-console\n  console.log(`Successfully extracted ${count} CSS files.`);\n}\n\nfunction resolveRequireInsertionFilename(filename: string) {\n  return filename.replace(/\\.tsx?/, '.js');\n}\n\nfunction resolveOutputFilename(filename: string, outDir: string) {\n  const folderStructure = path.relative(process.cwd(), path.dirname(filename));\n  const outputBasename = path\n    .basename(filename)\n    .replace(path.extname(filename), '.css');\n\n  return path.join(outDir, folderStructure, outputBasename);\n}\n"],"file":"cli.js"}